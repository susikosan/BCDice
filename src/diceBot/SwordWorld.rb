# -*- coding: utf-8 -*-

class SwordWorldEx < DiceBot
  setPrefixes(['K\d+.*'])

  def initialize
    rating_table = 0
    super()
    @rating_table = rating_table;
  end
  def gameName
    'ソードワールドEx'
  end

  def gameType
    "SwordWorldEx"
  end

  def getHelpMessage
    return <<INFO_MESSAGE_TEXT
自動的成功、成功、失敗、自動的失敗の自動判定を行います。

・レーティング表　(Kx)
　"Kキーナンバー+ボーナス"の形で記入します。
　ボーナスの部分に「K20+K30」のようにレーティングを取ることは出来ません。
　また、ボーナスは複数取ることが出来ます。
　レーティング表もダイスロールと同様に、他のプレイヤーに隠れてロールすることも可能です。
　例）K20　　　K10+5　　　k30　　　k10+10　　　Sk10-1　　　k10+5+2

・クリティカル値の設定
　クリティカル値は"[クリティカル値]"で指定します。
　指定しない場合はクリティカル値10とします。
　クリティカル処理が必要ないときは13などとしてください。(防御時などの対応)
　またタイプの軽減化のために末尾に「@クリティカル値」でも処理するようにしました。
　例）K20[10]　　　K10+5[9]　　　k30[10]　　　k10[9]+10　　　k10-5@9
INFO_MESSAGE_TEXT
  end

  def getHelpMessage
    '・SW　レーティング表　　　　　(Kx[c]+m$f) (x:キー, c:クリティカル値, m:ボーナス, f:出目修正)'
  end

  def changeText(string)
    return string unless( /(^|\s)[sS]?(K[\d]+)/i =~ string )

    debug('parren_killer_add before string', string)
    string = string.gsub(/\[(\d+)\]/i) {"c[#{$1}]"}
    string = string.gsub(/\@(\d+)/i) {"c[#{$1}]"}
    string = string.gsub(/\$([\+\-]?[\d]+)/i) {"m[#{$1}]"}
    string = string.gsub(/r([\+\-]?[\d]+)/i) {"r[#{$1}]"}
    debug('parren_killer_add after string', string)

    return string
  end


  def getRatingCommandStrings
    "cmCM"
  end


  def check_2D6(totalValue, dice_n, signOfInequality, diff, dice_cnt, dice_max, n1, n_max)  # ゲーム別成功度判定(2D6)
    if(dice_n >= 12)
      return " ＞ 自動的成功";
    end

    if(dice_n <=2)
      return " ＞ 自動的失敗";
    end

    return '' if(signOfInequality != ">=")
    return '' if(diff == "?")

    if(totalValue >= diff)
      return " ＞ 成功";
    end

    return " ＞ 失敗";
  end

  def rollDiceCommand(command)
    rating(command)
  end

  ####################        SWレーティング表       ########################
  def rating(string)     # レーティング表
    debug("rating string", string)

    commands = getRatingCommandStrings

    unless(/(^|\s)[sS]?(((k|K)[\d\+\-]+)([#{commands}]\[([\d\+\-]+)\])*([\d\+\-]*)([cmrCMR]\[([\d\+\-]+)\]|gf|GF)*)($|\s)/ =~ string)
      debug("not matched")
      return '1'
    end

    string = $2

    rateUp, string = getRateUpFromString(string)
    crit, string = getCriticalFromString(string)
    firstDiceChanteTo, firstDiceChangeModify, string = getDiceChangesFromString(string)

    key, addValue = getKeyAndAddValueFromString(string)

    return '1' unless( key =~ /([\d]+)/ )
    key = $1.to_i

    # 2.0対応
    rate_sw2_0 = getSW2_0_RatingTable

    keyMax = rate_sw2_0.length - 1
    debug("keyMax", keyMax)
    if(key > keyMax)
      return "キーナンバーは#{keyMax}までです"
    end

    newRates = getNewRates(rate_sw2_0)

    output = "KeyNo.#{key}"

    output += "c[#{crit}]" if(crit < 13)
    output += "m[#{firstDiceChangeModify}]" if( firstDiceChangeModify != 0 )
    output += "m[#{firstDiceChanteTo}]" if( firstDiceChanteTo != 0)
    output += "r[#{rateUp}]" if( rateUp != 0 )

    output, values = getAdditionalString(string, output)

    debug('output', output)

    if( addValue != 0 )
      output += "+#{addValue}" if(addValue > 0)
      output +=  "#{addValue}" if(addValue < 0)
    end

    output += " ＞ "

    diceResultTotals = []
    diceResults = []
    rateResults = []
    dice = 0
    diceOnlyTotal = 0
    totalValue = 0
    round = 0

    loop do
      dice, diceText = rollDice(values)

      if( firstDiceChanteTo != 0 )
        dice = firstDiceChanteTo
        firstDiceChanteTo = 0
      elsif( firstDiceChangeModify != 0 )
        dice += firstDiceChangeModify.to_i
        firstDiceChangeModify = 0;
      end

      dice += getAdditionalDiceValue(dice, values)

      dice = 2 if(dice < 2)
      dice = 12 if(dice > 12)

      currentKey = [key + round * rateUp, keyMax].min
      debug("currentKey", currentKey)
      rateValue = newRates[dice][currentKey]
      debug("rateValue", rateValue)

      totalValue += rateValue
      diceOnlyTotal += dice

      diceResultTotals << "#{dice}"
      diceResults << "#{diceText}"
      rateResults << ((dice > 2) ? rateValue : "**")

      round += 1

      break unless(dice >= crit)
    end

    limitLength = $SEND_STR_MAX - output.length
    output += getResultText(totalValue, addValue, diceResults, diceResultTotals,
                            rateResults, diceOnlyTotal, round, crit, limitLength)

    return output
  end


  def getAdditionalString(string, output)
    values = {}
    return output, values
  end

  def  getAdditionalDiceValue(dice, values)
    0
  end


  def getCriticalFromString(string)
    crit = 10

    regexp = /c\[(\d+)\]/i

    if( regexp =~ string )
      crit = $1.to_i
      crit = 3 if(crit < 3)        # エラートラップ(クリティカル値が3未満なら3とする)
      string = string.gsub(regexp, '')
    end

    return crit, string
  end

  def getDiceChangesFromString(string)
    firstDiceChanteTo = 0
    firstDiceChangeModify = 0

    regexp = /m\[([\d\+\-]+)\]/i

    if( regexp =~ string )
      firstDiceChangeModify = $1

      unless(/[\+\-]/ =~ firstDiceChangeModify)
        firstDiceChanteTo = firstDiceChangeModify.to_i
        firstDiceChangeModify = 0
      end

      string = string.gsub(regexp, '')
    end

    return firstDiceChanteTo, firstDiceChangeModify, string
  end

  def getRateUpFromString(string)
    rateUp = 0
    return rateUp, string
  end


  def getKeyAndAddValueFromString(string)
    key = nil
    addValue = 0

    if(/K(\d+)([\d\+\-]*)/i =~ string)    # ボーナスの抽出
      key = $1;
      if($2)
        addValue = parren_killer("(" + $2 + ")").to_i
      end
    else
      key = string;
    end

    return key, addValue
  end

  def getSW2_0_RatingTable
    rate_sw2_0 = [
                  #0
                  '*,0,0,0,1,2,2,3,3,4,4',
                  '*,0,0,0,1,2,3,3,3,4,4',
                  '*,0,0,0,1,2,3,4,4,4,4',
                  '*,0,0,1,1,2,3,4,4,4,5',
                  '*,0,0,1,2,2,3,4,4,5,5',
                  '*,0,1,1,2,2,3,4,5,5,5',
                  '*,0,1,1,2,3,3,4,5,5,5',
                  '*,0,1,1,2,3,4,4,5,5,6',
                  '*,0,1,2,2,3,4,4,5,6,6',
                  '*,0,1,2,3,3,4,4,5,6,7',
                  '*,1,1,2,3,3,4,5,5,6,7',
                  #11
                  '*,1,2,2,3,3,4,5,6,6,7',
                  '*,1,2,2,3,4,4,5,6,6,7',
                  '*,1,2,3,3,4,4,5,6,7,7',
                  '*,1,2,3,4,4,4,5,6,7,8',
                  '*,1,2,3,4,4,5,5,6,7,8',
                  '*,1,2,3,4,4,5,6,7,7,8',
                  '*,1,2,3,4,5,5,6,7,7,8',
                  '*,1,2,3,4,5,6,6,7,7,8',
                  '*,1,2,3,4,5,6,7,7,8,9',
                  '*,1,2,3,4,5,6,7,8,9,10',
                  #21
                  '*,1,2,3,4,6,6,7,8,9,10',
                  '*,1,2,3,5,6,6,7,8,9,10',
                  '*,2,2,3,5,6,7,7,8,9,10',
                  '*,2,3,4,5,6,7,7,8,9,10',
                  '*,2,3,4,5,6,7,8,8,9,10',
                  '*,2,3,4,5,6,8,8,9,9,10',
                  '*,2,3,4,6,6,8,8,9,9,10',
                  '*,2,3,4,6,6,8,9,9,10,10',
                  '*,2,3,4,6,7,8,9,9,10,10',
                  '*,2,4,4,6,7,8,9,10,10,10',
                  #31
                  '*,2,4,5,6,7,8,9,10,10,11',
                  '*,3,4,5,6,7,8,10,10,10,11',
                  '*,3,4,5,6,8,8,10,10,10,11',
                  '*,3,4,5,6,8,9,10,10,11,11',
                  '*,3,4,5,7,8,9,10,10,11,12',
                  '*,3,5,5,7,8,9,10,11,11,12',
                  '*,3,5,6,7,8,9,10,11,12,12',
                  '*,3,5,6,7,8,10,10,11,12,13',
                  '*,4,5,6,7,8,10,11,11,12,13',
                  '*,4,5,6,7,9,10,11,11,12,13',
                  #41
                  '*,4,6,6,7,9,10,11,12,12,13',
                  '*,4,6,7,7,9,10,11,12,13,13',
                  '*,4,6,7,8,9,10,11,12,13,14',
                  '*,4,6,7,8,10,10,11,12,13,14',
                  '*,4,6,7,9,10,10,11,12,13,14',
                  '*,4,6,7,9,10,10,12,13,13,14',
                  '*,4,6,7,9,10,11,12,13,13,15',
                  '*,4,6,7,9,10,12,12,13,13,15',
                  '*,4,6,7,10,10,12,12,13,14,15',
                  '*,4,6,8,10,10,12,12,13,15,15',
                  #51
                  '*,5,7,8,10,10,12,12,13,15,15',
                  '*,5,7,8,10,11,12,12,13,15,15',
                  '*,5,7,9,10,11,12,12,14,15,15',
                  '*,5,7,9,10,11,12,13,14,15,16',
                  '*,5,7,10,10,11,12,13,14,16,16',
                  '*,5,8,10,10,11,12,13,15,16,16',
                  '*,5,8,10,11,11,12,13,15,16,17',
                  '*,5,8,10,11,12,12,13,15,16,17',
                  '*,5,9,10,11,12,12,14,15,16,17',
                  '*,5,9,10,11,12,13,14,15,16,18',
                  #61
                  '*,5,9,10,11,12,13,14,16,17,18',
                  '*,5,9,10,11,13,13,14,16,17,18',
                  '*,5,9,10,11,13,13,15,17,17,18',
                  '*,5,9,10,11,13,14,15,17,17,18',
                  '*,5,9,10,12,13,14,15,17,18,18',
                  '*,5,9,10,12,13,15,15,17,18,19',
                  '*,5,9,10,12,13,15,16,17,19,19',
                  '*,5,9,10,12,14,15,16,17,19,19',
                  '*,5,9,10,12,14,16,16,17,19,19',
                  '*,5,9,10,12,14,16,17,18,19,19',
                  #71
                  '*,5,9,10,13,14,16,17,18,19,20',
                  '*,5,9,10,13,15,16,17,18,19,20',
                  '*,5,9,10,13,15,16,17,19,20,21',
                  '*,6,9,10,13,15,16,18,19,20,21',
                  '*,6,9,10,13,16,16,18,19,20,21',
                  '*,6,9,10,13,16,17,18,19,20,21',
                  '*,6,9,10,13,16,17,18,20,21,22',
                  '*,6,9,10,13,16,17,19,20,22,23',
                  '*,6,9,10,13,16,18,19,20,22,23',
                  '*,6,9,10,13,16,18,20,21,22,23',
                  #81
                  '*,6,9,10,13,17,18,20,21,22,23',
                  '*,6,9,10,14,17,18,20,21,22,24',
                  '*,6,9,11,14,17,18,20,21,23,24',
                  '*,6,9,11,14,17,19,20,21,23,24',
                  '*,6,9,11,14,17,19,21,22,23,24',
                  '*,7,10,11,14,17,19,21,22,23,25',
                  '*,7,10,12,14,17,19,21,22,24,25',
                  '*,7,10,12,14,18,19,21,22,24,25',
                  '*,7,10,12,15,18,19,21,22,24,26',
                  '*,7,10,12,15,18,19,21,23,25,26',
                  #91
                  '*,7,11,13,15,18,19,21,23,25,26',
                  '*,7,11,13,15,18,20,21,23,25,27',
                  '*,8,11,13,15,18,20,22,23,25,27',
                  '*,8,11,13,16,18,20,22,23,25,28',
                  '*,8,11,14,16,18,20,22,23,26,28',
                  '*,8,11,14,16,19,20,22,23,26,28',
                  '*,8,12,14,16,19,20,22,24,26,28',
                  '*,8,12,15,16,19,20,22,24,27,28',
                  '*,8,12,15,17,19,20,22,24,27,29',
                  '*,8,12,15,18,19,20,22,24,27,30',



                  '*,8,12,15,18,20,21,24,25,27,30',
                  '*,8,12,15,18,20,22,24,25,27,30',
                  '*,8,12,15,18,20,22,24,25,28,30',
                  '*,8,12,15,18,20,22,24,26,28,30',
                  '*,8,12,15,18,20,22,24,26,28,30',
                  '*,8,12,15,18,21,22,24,26,28,30',
                  '*,8,12,15,18,21,22,25,26,29,31',
                  '*,9,12,15,18,21,22,25,26,29,31',
                  '*,9,13,15,18,21,23,25,27,29,31',
                  '*,9,13,15,18,21,23,25,27,29,32',
                  '*,9,13,16,18,21,23,25,27,30,32',
                  '*,9,13,16,18,22,23,25,27,30,32',
                  '*,9,13,16,19,22,23,26,27,30,32',
                  '*,9,13,16,19,22,24,26,28,30,33',
                  '*,9,13,16,19,22,24,26,28,31,33',
                  '*,9,13,16,19,22,24,26,28,31,33',
                  '*,9,13,16,19,22,24,26,28,31,33',
                  '*,9,14,17,19,23,24,27,29,31,34',
                  '*,9,14,17,20,23,24,27,29,32,34',
                  '*,9,14,17,20,23,25,27,29,32,34',
                  '*,9,14,17,20,23,25,27,29,32,34',
                  '*,10,14,17,20,23,25,28,30,32,35',
                  '*,10,14,17,20,24,25,28,30,33,35',
                  '*,10,14,17,20,24,26,28,30,33,35',
                  '*,10,14,17,20,24,26,28,30,33,35',
                  '*,10,14,17,21,24,26,28,30,33,36',
                  '*,10,15,18,21,24,26,29,31,34,36',
                  '*,10,15,18,21,24,26,29,31,34,36',
                  '*,10,15,18,21,25,26,29,31,34,37',
                  '*,10,15,18,21,25,27,29,31,34,37',
                  '*,10,15,18,21,25,27,29,31,35,37',
                  '*,10,15,18,21,25,27,30,32,35,37',
                  '*,10,15,18,22,25,27,30,32,35,38',
                  '*,10,15,19,22,25,27,30,32,35,38',
                  '*,11,15,19,22,26,28,30,32,36,38',
                  '*,11,15,19,22,26,28,30,33,36,38',
                  '*,11,16,19,22,26,28,31,33,36,39',
                  '*,11,16,19,22,26,28,31,33,36,39',
                  '*,11,16,19,22,26,28,31,33,37,39',
                  '*,11,16,19,23,27,29,31,33,37,39',
                  '*,11,16,19,23,27,29,32,34,37,40',
                  '*,11,16,20,23,27,29,32,34,37,40',
                  '*,11,16,20,23,27,29,32,34,38,40',
                  '*,11,16,20,23,27,29,32,34,38,40',
                  '*,11,16,20,23,27,29,32,35,38,41',
                  '*,11,17,20,24,28,30,33,35,38,41',
                  '*,11,17,20,24,28,30,33,35,39,41',
                  '*,11,17,20,24,28,30,33,35,39,42',
                  '*,12,17,20,24,28,30,33,35,39,42',
                  '*,12,17,21,24,28,30,33,36,39,42',
                  '*,12,17,21,24,28,31,34,36,40,42',
                  '*,12,17,21,24,29,31,34,36,40,43',
                  '*,12,17,21,25,29,31,34,36,40,43',
                  '*,12,17,21,25,29,31,34,37,40,43',
                  '*,12,17,21,25,29,31,34,37,40,43',
                  '*,12,18,21,25,29,32,35,37,41,44',
                  '*,12,18,21,25,30,32,35,37,41,44',
                  '*,12,18,22,25,30,32,35,37,41,44',
                  '*,12,18,22,26,30,32,35,38,41,44',
                  '*,12,18,22,26,30,32,35,38,42,45',
                  '*,12,18,22,26,30,33,36,38,42,45',
                  '*,12,18,22,26,30,33,36,38,42,45',
                  '*,13,18,22,26,31,33,36,39,42,45',
                  '*,13,18,22,26,31,33,36,39,43,46',
                  '*,13,19,22,26,31,33,37,39,43,46',
                  '*,13,19,23,27,31,33,37,39,43,46',
                  '*,13,19,23,27,31,34,37,40,43,47',
                  '*,13,19,23,27,31,34,37,40,44,47',
                  '*,13,19,23,27,32,34,37,40,44,47',
                  '*,13,19,23,27,32,34,38,40,44,47',
                  '*,13,19,23,27,32,34,38,40,44,48',
                  '*,13,19,23,27,32,35,38,41,45,48',
                  '*,13,19,24,28,32,35,38,41,45,48',
                  '*,13,19,24,28,33,35,38,41,45,48',
                  '*,13,20,24,28,33,35,39,41,45,49',
                  '*,14,20,24,28,33,35,39,42,46,49',
                  '*,14,20,24,28,33,36,39,42,46,49',
                  '*,14,20,24,28,33,36,39,42,46,49',
                  '*,14,20,24,29,33,36,39,42,46,50',
                  '*,14,20,24,29,34,36,40,42,47,50',
                  '*,14,20,25,29,34,36,40,43,47,50',
                  '*,14,20,25,29,34,37,40,43,47,50',
                  '*,14,20,25,29,34,37,40,43,47,51',
                  '*,14,21,25,29,34,37,41,43,48,51',
                  '*,14,21,25,29,34,37,41,44,48,51',
                  '*,14,21,25,30,35,37,41,44,48,52',
                  '*,14,21,25,30,35,37,41,44,48,52',
                  '*,14,21,25,30,35,38,41,44,49,52',
                  '*,14,21,26,30,35,38,42,44,49,52',
                  '*,15,21,26,30,35,38,42,45,49,53',
                  '*,15,21,26,30,36,38,42,45,49,53',
                  '*,15,21,26,30,36,38,42,45,50,53',
                  '*,15,22,26,31,36,39,42,45,50,53',
                  '*,15,22,26,31,36,39,43,46,50,54',
                  '*,15,22,26,31,36,39,43,46,50,54',
                  '*,15,22,26,31,36,39,43,46,51,54',
                  '*,15,22,27,31,37,39,43,46,51,54',
                  '*,15,22,27,31,37,40,43,46,51,55',
                  '*,15,22,27,32,37,40,44,47,51,55',
                  '*,15,22,27,32,37,40,44,47,52,55',
                  '*,15,22,27,32,37,40,44,47,52,55',
                  '*,15,22,27,32,37,40,44,47,52,56',
                  '*,15,23,27,32,38,41,44,48,52,56',
                  '*,16,23,27,32,38,41,45,48,53,56',
                  '*,16,23,28,32,38,41,45,48,53,57',
                  '*,16,23,28,33,38,41,45,48,53,57',
                  '*,16,23,28,33,38,41,45,48,53,57',
                  '*,16,23,28,33,39,41,46,49,54,57',
                  '*,16,23,28,33,39,42,46,49,54,58',
                  '*,16,23,28,33,39,42,46,49,54,58',
                  '*,16,23,28,33,39,42,46,49,54,58',
                  '*,16,24,29,34,39,42,46,50,54,58',
                  '*,16,24,29,34,39,42,47,50,55,59',
                  '*,16,24,29,34,40,43,47,50,55,59',
                  '*,16,24,29,34,40,43,47,50,55,59',
                  '*,16,24,29,34,40,43,47,50,55,59',
                  '*,16,24,29,34,40,43,47,51,56,60',
                  '*,17,24,29,34,40,43,48,51,56,60',
                  '*,17,24,29,35,40,44,48,51,56,60',
                  '*,17,24,30,35,41,44,48,51,56,60',
                  '*,17,24,30,35,41,44,48,52,57,61',
                  '*,17,25,30,35,41,44,48,52,57,61',
                  '*,17,25,30,35,41,44,49,52,57,61',
                  '*,17,25,30,35,41,45,49,52,57,62',
                  '*,17,25,30,35,42,45,49,52,58,62',
                  '*,17,25,30,36,42,45,49,53,58,62',
                  '*,17,25,30,36,42,45,49,53,58,62',
                  '*,17,25,31,36,42,45,50,53,58,63',
                  '*,17,25,31,36,42,45,50,53,59,63',
                  '*,17,25,31,36,42,46,50,54,59,63',
                  '*,18,26,31,36,43,46,50,54,59,63',
                  '*,18,26,31,37,43,46,51,54,59,64',
                  '*,18,26,31,37,43,46,51,54,60,64',
                  '*,18,26,31,37,43,46,51,54,60,64',
                  '*,18,26,31,37,43,47,51,55,60,64',
                  '*,18,26,32,37,43,47,51,55,60,65',
                  '*,18,26,32,37,44,47,52,55,61,65',
                  '*,18,26,32,37,44,47,52,55,61,65',
                  '*,18,26,32,38,44,47,52,56,61,65',
                  '*,18,26,32,38,44,48,52,56,61,66',
                  '*,18,27,32,38,44,48,52,56,62,66',
                  '*,18,27,32,38,45,48,53,56,62,66',
                  '*,18,27,33,38,45,48,53,56,62,67',
                  '*,18,27,33,38,45,48,53,57,62,67',
                  '*,19,27,33,38,45,48,53,57,63,67',
                  '*,19,27,33,39,45,49,53,57,63,67',
                  '*,19,27,33,39,45,49,54,57,63,68',
                  '*,19,27,33,39,46,49,54,58,63,68',
                  '*,19,27,33,39,46,49,54,58,64,68',
                  '*,19,28,33,39,46,49,54,58,64,68',
                  '*,19,28,34,39,46,50,54,58,64,69',
                  '*,19,28,34,40,46,50,55,58,64,69',
                  '*,19,28,34,40,47,50,55,59,65,69',
                  '*,19,28,34,40,47,50,55,59,65,69',
                  '*,19,28,34,40,47,50,55,59,65,70',
                  '*,19,28,34,40,47,51,56,59,65,70',
                  '*,19,28,34,40,47,51,56,60,66,70',
                  '*,19,28,34,40,47,51,56,60,66,70',
                  '*,20,28,35,41,48,51,56,60,66,71',
                  '*,20,29,35,41,48,51,56,60,66,71',
                  '*,20,29,35,41,48,52,57,60,67,71',
                  '*,20,29,35,41,48,52,57,61,67,72',
                  '*,20,29,35,41,48,52,57,61,67,72',
                  '*,20,29,35,41,48,52,57,61,67,72',
                  '*,20,29,35,42,49,52,57,61,67,72',
                  '*,20,29,35,42,49,52,58,62,68,73',
                  '*,20,29,36,42,49,53,58,62,68,73',
                  '*,20,29,36,42,49,53,58,62,68,73',
                  '*,20,30,36,42,49,53,58,62,68,73',
                  '*,20,30,36,42,50,53,58,62,69,74',
                  '*,20,30,36,42,50,53,59,63,69,74',
                  '*,20,30,36,43,50,54,59,63,69,74',
                  '*,21,30,36,43,50,54,59,63,69,74',
                  '*,21,30,36,43,50,54,59,63,70,75',
                  '*,21,30,37,43,50,54,60,64,70,75',
                  '*,21,30,37,43,51,54,60,64,70,75',
                  '*,21,30,37,43,51,55,60,64,70,75',
                  '*,21,31,37,43,51,55,60,64,71,76',
                  '*,21,31,37,44,51,55,60,64,71,76',
                  '*,21,31,37,44,51,55,61,65,71,76',
                  '*,21,31,37,44,51,55,61,65,71,77',
                  '*,21,31,38,44,52,56,61,65,72,77',
                  '*,21,31,38,44,52,56,61,65,72,77',
                  '*,21,31,38,44,52,56,61,66,72,77',
                  '*,21,31,38,45,52,56,62,66,72,78',
                  '*,22,31,38,45,52,56,62,66,73,78',
                  '*,22,31,38,45,53,56,62,66,73,78',
                  '*,22,32,38,45,53,57,62,67,73,78',
                  '*,22,32,38,45,53,57,62,67,73,79',
                  '*,22,32,39,45,53,57,63,67,74,79',
                  '*,22,32,39,45,53,57,63,67,74,79',
                  '*,22,32,39,46,53,57,63,67,74,79',
                  '*,22,32,39,46,54,58,63,68,74,80',
                  '*,22,32,39,46,54,58,63,68,75,80',
                  '*,22,32,39,46,54,58,64,68,75,80',
                  '*,22,32,39,46,54,58,64,68,75,80',
                  '*,22,33,39,46,54,58,64,69,75,81',
                  '*,22,33,40,46,54,59,64,69,76,81',
                  '*,22,33,40,47,55,59,65,69,76,81',
                  '*,23,33,40,47,55,59,65,69,76,82',
                  '*,23,33,40,47,55,59,65,69,76,82',
                  '*,23,33,40,47,55,59,65,70,77,82',
                  '*,23,33,40,47,55,60,65,70,77,82',
                  '*,23,33,40,47,56,60,66,70,77,83',
                  '*,23,33,40,48,56,60,66,70,77,83',
                  '*,23,33,41,48,56,60,66,71,78,83',
                  '*,23,34,41,48,56,60,66,71,78,83',
                  '*,23,34,41,48,56,60,66,71,78,84',
                  '*,23,34,41,48,56,61,67,71,78,84',
                  '*,23,34,41,48,57,61,67,71,79,84',
                  '*,23,34,41,48,57,61,67,72,79,84',
                  '*,23,34,41,49,57,61,67,72,79,85',
                  '*,23,34,42,49,57,61,67,72,79,85',
                  '*,24,34,42,49,57,62,68,72,80,85',
                  '*,24,34,42,49,57,62,68,73,80,85',
                  '*,24,35,42,49,58,62,68,73,80,86',
                  '*,24,35,42,49,58,62,68,73,80,86',
                  '*,24,35,42,50,58,62,68,73,81,86',
                  '*,24,35,42,50,58,63,69,73,81,87',
                  '*,24,35,42,50,58,63,69,74,81,87',
                  '*,24,35,43,50,59,63,69,74,81,87',
                  '*,24,35,43,50,59,63,69,74,81,87',
                  '*,24,35,43,50,59,63,70,74,82,88',
                  '*,24,35,43,50,59,64,70,75,82,88',
                  '*,24,35,43,51,59,64,70,75,82,88',
                  '*,24,36,43,51,59,64,70,75,82,88',
                  '*,24,36,43,51,60,64,70,75,83,89',
                  '*,25,36,43,51,60,64,71,75,83,89',
                  '*,25,36,44,51,60,64,71,76,83,89',
                  '*,25,36,44,51,60,65,71,76,83,89',
                  '*,25,36,44,51,60,65,71,76,84,90',
                  '*,25,36,44,52,60,65,71,76,84,90',
                  '*,25,36,44,52,61,65,72,77,84,90',
                  '*,25,36,44,52,61,65,72,77,84,90',
                  '*,25,37,44,52,61,66,72,77,85,91',
                  '*,25,37,44,52,61,66,72,77,85,91',
                  '*,25,37,45,52,61,66,72,77,85,91',
                  '*,25,37,45,53,62,66,73,78,85,92',
                  '*,25,37,45,53,62,66,73,78,86,92',
                  '*,25,37,45,53,62,67,73,78,86,92',
                  '*,25,37,45,53,62,67,73,78,86,92',
                  '*,26,37,45,53,62,67,73,79,86,93',
                  '*,26,37,45,53,62,67,74,79,87,93',
                  '*,26,38,45,53,63,67,74,79,87,93',
                  '*,26,38,46,54,63,68,74,79,87,93',
                  '*,26,38,46,54,63,68,74,79,87,94',
                  '*,26,38,46,54,63,68,75,80,88,94',
                  '*,26,38,46,54,63,68,75,80,88,94',
                  '*,26,38,46,54,63,68,75,80,88,94',
                  '*,26,38,46,54,64,68,75,80,88,95',
                  '*,26,38,46,54,64,69,75,81,89,95',
                  '*,26,38,47,55,64,69,76,81,89,95',
                  '*,26,38,47,55,64,69,76,81,89,95',
                  '*,26,39,47,55,64,69,76,81,89,96',
                  '*,27,39,47,55,65,69,76,81,90,96',
                  '*,27,39,47,55,65,70,76,82,90,96',
                  '*,27,39,47,55,65,70,77,82,90,97',
                  '*,27,39,47,56,65,70,77,82,90,97',
                  '*,27,39,47,56,65,70,77,82,91,97',
                  '*,27,39,48,56,65,70,77,83,91,97',
                  '*,27,39,48,56,66,71,77,83,91,98',
                  '*,27,39,48,56,66,71,78,83,91,98',
                  '*,27,40,48,56,66,71,78,83,92,98',
                  '*,27,40,48,56,66,71,78,83,92,98',
                  '*,27,40,48,57,66,71,78,84,92,99',
                  '*,27,40,48,57,66,72,79,84,92,99',
                  '*,27,40,48,57,67,72,79,84,93,99',
                  '*,27,40,49,57,67,72,79,84,93,99',
                  '*,28,40,49,57,67,72,79,85,93,100',
                  '*,28,40,49,57,67,72,79,85,93,100',
                  '*,28,40,49,58,67,72,80,85,94,100',
                  '*,28,40,49,58,68,73,80,85,94,100',
                  '*,28,41,49,58,68,73,80,85,94,101',
                  '*,28,41,49,58,68,73,80,86,94,101',
                  '*,28,41,49,58,68,73,80,86,94,101',
                  '*,28,41,50,58,68,73,81,86,95,102',
                  '*,28,41,50,58,68,74,81,86,95,102',
                  '*,28,41,50,59,69,74,81,87,95,102',
                  '*,28,41,50,59,69,74,81,87,95,102',
                  '*,28,41,50,59,69,74,81,87,96,103',
                  '*,28,41,50,59,69,74,82,87,96,103',
                  '*,28,42,50,59,69,75,82,87,96,103',
                  '*,29,42,50,59,69,75,82,88,96,103',
                  '*,29,42,51,59,70,75,82,88,97,104',
                  '*,29,42,51,60,70,75,82,88,97,104',
                  '*,29,42,51,60,70,75,83,88,97,104',
                  '*,29,42,51,60,70,76,83,89,97,104',
                  '*,29,42,51,60,70,76,83,89,98,105',
                  '*,29,42,51,60,71,76,83,89,98,105',
                  '*,29,42,51,60,71,76,84,89,98,105',
                  '*,29,42,52,61,71,76,84,89,98,105',
                  '*,29,43,52,61,71,76,84,90,99,106',
                  '*,29,43,52,61,71,77,84,90,99,106',
                  '*,29,43,52,61,71,77,84,90,99,106',
                  '*,29,43,52,61,72,77,85,90,99,107',
                  '*,29,43,52,61,72,77,85,91,100,107',
                  '*,30,43,52,61,72,77,85,91,100,107',
                  '*,30,43,52,62,72,78,85,91,100,107',
                  '*,30,43,53,62,72,78,85,91,100,108',
                  '*,30,43,53,62,72,78,86,91,101,108',
                  '*,30,44,53,62,73,78,86,92,101,108',
                  '*,30,44,53,62,73,78,86,92,101,108',
                  '*,30,44,53,62,73,79,86,92,101,109',
                  '*,30,44,53,62,73,79,86,92,102,109',
                  '*,30,44,53,63,73,79,87,93,102,109',
                  '*,30,44,53,63,74,79,87,93,102,109',
                  '*,30,44,54,63,74,79,87,93,102,110',
                  '*,30,44,54,63,74,79,87,93,103,110',
                  '*,30,44,54,63,74,80,87,94,103,110',
                  '*,31,44,54,63,74,80,88,94,103,110',
                  '*,31,45,54,64,74,80,88,94,103,111',
                  '*,31,45,54,64,75,80,88,94,104,111',
                  '*,31,45,54,64,75,80,88,94,104,111',
                  '*,31,45,54,64,75,81,89,95,104,111',
                  '*,31,45,55,64,75,81,89,95,104,112',
                  '*,31,45,55,64,75,81,89,95,105,112',
                  '*,31,45,55,64,76,81,89,95,105,112',
                  '*,31,45,55,65,76,81,89,96,105,113',
                  '*,31,45,55,65,76,82,90,96,105,113',
                  '*,31,46,55,65,76,82,90,96,106,113',
                  '*,31,46,55,65,76,82,90,96,106,113',
                  '*,31,46,56,65,76,82,90,96,106,114',
                  '*,31,46,56,65,77,82,90,97,106,114',
                  '*,32,46,56,66,77,83,91,97,107,114',
                  '*,32,46,56,66,77,83,91,97,107,114',
                  '*,32,46,56,66,77,83,91,97,107,115',
                  '*,32,46,56,66,77,83,91,98,107,115',
                  '*,32,46,56,66,77,83,91,98,108,115',
                  '*,32,47,56,66,78,83,92,98,108,115',
                  '*,32,47,57,66,78,84,92,98,108,116',
                  '*,32,47,57,67,78,84,92,98,108,116',
                  '*,32,47,57,67,78,84,92,99,108,116',
                  '*,32,47,57,67,78,84,93,99,109,116',
                  '*,32,47,57,67,79,84,93,99,109,117',
                  '*,32,47,57,67,79,85,93,99,109,117',
                  '*,32,47,57,67,79,85,93,100,109,117',
                  '*,32,47,57,67,79,85,93,100,110,118',
                  '*,33,47,58,68,79,85,94,100,110,118',
                  '*,33,48,58,68,79,85,94,100,110,118',
                  '*,33,48,58,68,80,86,94,100,110,118',
                  '*,33,48,58,68,80,86,94,101,111,119',
                  '*,33,48,58,68,80,86,94,101,111,119',
                  '*,33,48,58,68,80,86,95,101,111,119',
                  '*,33,48,58,69,80,86,95,101,111,119',
                  '*,33,48,58,69,80,87,95,102,112,120',
                  '*,33,48,59,69,81,87,95,102,112,120',
                  '*,33,48,59,69,81,87,95,102,112,120',
                  '*,33,49,59,69,81,87,96,102,112,120',
                  '*,33,49,59,69,81,87,96,102,113,121',
                  '*,33,49,59,69,81,87,96,103,113,121',
                  '*,33,49,59,70,82,88,96,103,113,121',
                  '*,34,49,59,70,82,88,96,103,113,121',
                  '*,34,49,59,70,82,88,97,103,114,122',
                  '*,34,49,60,70,82,88,97,104,114,122',
                  '*,34,49,60,70,82,88,97,104,114,122',
                  '*,34,49,60,70,82,89,97,104,114,123',
                  '*,34,49,60,70,83,89,98,104,115,123',
                  '*,34,50,60,71,83,89,98,104,115,123',
                  '*,34,50,60,71,83,89,98,105,115,123',
                  '*,34,50,60,71,83,89,98,105,115,124',
                  '*,34,50,61,71,83,90,98,105,116,124',
                  '*,34,50,61,71,83,90,99,105,116,124',
                  '*,34,50,61,71,84,90,99,106,116,124',
                  '*,34,50,61,72,84,90,99,106,116,125',
                  '*,35,50,61,72,84,90,99,106,117,125',
                  '*,35,50,61,72,84,91,99,106,117,125',
                  '*,35,51,61,72,84,91,100,106,117,125',
                  '*,35,51,61,72,85,91,100,107,117,126',
                  '*,35,51,62,72,85,91,100,107,118,126',
                  '*,35,51,62,72,85,91,100,107,118,126',
                  '*,35,51,62,73,85,91,100,107,118,126',
                  '*,35,51,62,73,85,92,101,108,118,127',
                  '*,35,51,62,73,85,92,101,108,119,127',
                  '*,35,51,62,73,86,92,101,108,119,127',
                  '*,35,51,62,73,86,92,101,108,119,128',
                  '*,35,51,62,73,86,92,101,108,119,128',
                  '*,35,52,63,74,86,93,102,109,120,128',
                  '*,35,52,63,74,86,93,102,109,120,128',
                  '*,36,52,63,74,86,93,102,109,120,129',
                  '*,36,52,63,74,87,93,102,109,120,129',
                  '*,36,52,63,74,87,93,103,110,121,129',
                  '*,36,52,63,74,87,94,103,110,121,129',
                  '*,36,52,63,74,87,94,103,110,121,130',
                  '*,36,52,63,75,87,94,103,110,121,130',
                  '*,36,52,64,75,88,94,103,110,121,130',
                  '*,36,53,64,75,88,94,104,111,122,130',
                  '*,36,53,64,75,88,95,104,111,122,131',
                  '*,36,53,64,75,88,95,104,111,122,131',
                  '*,36,53,64,75,88,95,104,111,122,131',
                  '*,36,53,64,75,88,95,104,112,123,131',
                  '*,36,53,64,76,89,95,105,112,123,132',
                  '*,36,53,65,76,89,95,105,112,123,132',
                  '*,37,53,65,76,89,96,105,112,123,132',
                  '*,37,53,65,76,89,96,105,112,124,133',
                  '*,37,54,65,76,89,96,105,113,124,133',
                  '*,37,54,65,76,89,96,106,113,124,133',
                  '*,37,54,65,77,90,96,106,113,124,133',
                  '*,37,54,65,77,90,97,106,113,125,134',
                  '*,37,54,65,77,90,97,106,114,125,134',
                  '*,37,54,66,77,90,97,106,114,125,134',
                  '*,37,54,66,77,90,97,107,114,125,134',
                  '*,37,54,66,77,91,97,107,114,126,135',
                  '*,37,54,66,77,91,98,107,114,126,135',
                  '*,37,54,66,78,91,98,107,115,126,135',
                  '*,37,55,66,78,91,98,108,115,126,135',
                  '*,37,55,66,78,91,98,108,115,127,136',
                  '*,38,55,66,78,91,98,108,115,127,136',
                  '*,38,55,67,78,92,99,108,116,127,136',
                  '*,38,55,67,78,92,99,108,116,127,136',
                  '*,38,55,67,78,92,99,109,116,128,137',
                  '*,38,55,67,79,92,99,109,116,128,137',
                  '*,38,55,67,79,92,99,109,116,128,137',
                  '*,38,55,67,79,92,99,109,117,128,138',
                  '*,38,56,67,79,93,100,109,117,129,138',
                  '*,38,56,67,79,93,100,110,117,129,138',
                  '*,38,56,68,79,93,100,110,117,129,138',
                  '*,38,56,68,80,93,100,110,118,129,139',
                  '*,38,56,68,80,93,100,110,118,130,139',
                  '*,38,56,68,80,94,101,110,118,130,139',
                  '*,39,56,68,80,94,101,111,118,130,139',
                  '*,39,56,68,80,94,101,111,119,130,140',
                  '*,39,56,68,80,94,101,111,119,131,140',
                  '*,39,56,68,80,94,101,111,119,131,140',
                  '*,39,57,69,81,94,102,112,119,131,140',
                  '*,39,57,69,81,95,102,112,119,131,141',
                  '*,39,57,69,81,95,102,112,120,132,141',
                  '*,39,57,69,81,95,102,112,120,132,141',
                  '*,39,57,69,81,95,102,112,120,132,141',
                  '*,39,57,69,81,95,103,113,120,132,142',
                  '*,39,57,69,82,95,103,113,121,133,142',
                  '*,39,57,70,82,96,103,113,121,133,142',
                  '*,39,57,70,82,96,103,113,121,133,143',
                  '*,39,58,70,82,96,103,113,121,133,143',
                  '*,40,58,70,82,96,103,114,121,134,143',
                  '*,40,58,70,82,96,104,114,122,134,143',
                  '*,40,58,70,82,97,104,114,122,134,144',
                  '*,40,58,70,83,97,104,114,122,134,144',
                  '*,40,58,70,83,97,104,114,122,135,144',
                  '*,40,58,71,83,97,104,115,123,135,144',
                  '*,40,58,71,83,97,105,115,123,135,145',
                  '*,40,58,71,83,97,105,115,123,135,145',
                  '*,40,58,71,83,98,105,115,123,135,145',
                  '*,40,59,71,83,98,105,115,123,136,145',
                  '*,40,59,71,84,98,105,116,124,136,146',
                  '*,40,59,71,84,98,106,116,124,136,146',
                  '*,40,59,71,84,98,106,116,124,136,146',
                  '*,40,59,72,84,98,106,116,124,137,146',
                  '*,41,59,72,84,99,106,117,125,137,147',
                  '*,41,59,72,84,99,106,117,125,137,147',
                  '*,41,59,72,85,99,106,117,125,137,147',
                  '*,41,59,72,85,99,107,117,125,138,148',
                  '*,41,60,72,85,99,107,117,125,138,148',
                  '*,41,60,72,85,100,107,118,126,138,148',
                  '*,41,60,72,85,100,107,118,126,138,148',
                  '*,41,60,73,85,100,107,118,126,139,149',
                  '*,41,60,73,85,100,108,118,126,139,149',
                  '*,41,60,73,86,100,108,118,127,139,149',
                  '*,41,60,73,86,100,108,119,127,139,149',
                  '*,41,60,73,86,101,108,119,127,140,150',
                  '*,41,60,73,86,101,108,119,127,140,150',
                  '*,41,60,73,86,101,109,119,127,140,150',
                  '*,42,61,73,86,101,109,119,128,140,150',
                  '*,42,61,74,86,101,109,120,128,141,151',
                  '*,42,61,74,87,101,109,120,128,141,151',
                  '*,42,61,74,87,102,109,120,128,141,151',
                  '*,42,61,74,87,102,110,120,129,141,151',
                  '*,42,61,74,87,102,110,120,129,142,152',
                  '*,42,61,74,87,102,110,121,129,142,152',
                  '*,42,61,74,87,102,110,121,129,142,152',
                  '*,42,61,75,88,103,110,121,129,142,153',
                  '*,42,62,75,88,103,110,121,130,143,153',
                  '*,42,62,75,88,103,111,122,130,143,153',
                  '*,42,62,75,88,103,111,122,130,143,153',
                  '*,42,62,75,88,103,111,122,130,143,154',
                  '*,42,62,75,88,103,111,122,131,144,154',
                  '*,43,62,75,88,104,111,122,131,144,154',
                  '*,43,62,75,89,104,112,123,131,144,154',
                  '*,43,62,76,89,104,112,123,131,144,155',
                  '*,43,62,76,89,104,112,123,131,145,155',
                  '*,43,63,76,89,104,112,123,132,145,155',
                  '*,43,63,76,89,105,112,123,132,145,155',
                  '*,43,63,76,89,105,113,124,132,145,156',
                  '*,43,63,76,90,105,113,124,132,146,156',
                  '*,43,63,76,90,105,113,124,133,146,156',
                  '*,43,63,76,90,105,113,124,133,146,156',
                  '*,43,63,77,90,105,113,124,133,146,157',
                  '*,43,63,77,90,106,114,125,133,147,157',
                  '*,43,63,77,90,106,114,125,133,147,157',
                  '*,44,63,77,90,106,114,125,134,147,158',
                  '*,44,64,77,91,106,114,125,134,147,158',
                  '*,44,64,77,91,106,114,125,134,148,158',
                  '*,44,64,77,91,106,114,126,134,148,158',
                  '*,44,64,77,91,107,115,126,135,148,159',
                  '*,44,64,78,91,107,115,126,135,148,159',
                  '*,44,64,78,91,107,115,126,135,148,159',
                  '*,44,64,78,91,107,115,127,135,149,159',
                  '*,44,64,78,92,107,115,127,135,149,160',
                  '*,44,64,78,92,108,116,127,136,149,160',
                  '*,44,65,78,92,108,116,127,136,149,160',
                  '*,44,65,78,92,108,116,127,136,150,160',
                  '*,44,65,79,92,108,116,128,136,150,161',
                  '*,44,65,79,92,108,116,128,137,150,161',
                  '*,45,65,79,93,108,117,128,137,150,161',
                  '*,45,65,79,93,109,117,128,137,151,161',
                  '*,45,65,79,93,109,117,128,137,151,162',
                  '*,45,65,79,93,109,117,129,137,151,162',
                  '*,45,65,79,93,109,117,129,138,151,162',
                  '*,45,65,79,93,109,118,129,138,152,163',
                  '*,45,66,80,93,109,118,129,138,152,163',
                  '*,45,66,80,94,110,118,129,138,152,163',
                  '*,45,66,80,94,110,118,130,139,152,163',
                  '*,45,66,80,94,110,118,130,139,153,164',
                  '*,45,66,80,94,110,118,130,139,153,164',
                  '*,45,66,80,94,110,119,130,139,153,164',
                  '*,45,66,80,94,111,119,131,139,153,164',
                  '*,45,66,80,94,111,119,131,140,154,165',
                  '*,46,66,81,95,111,119,131,140,154,165',
                  '*,46,67,81,95,111,119,131,140,154,165',
                  '*,46,67,81,95,111,120,131,140,154,165',
                  '*,46,67,81,95,111,120,132,141,155,166',
                  '*,46,67,81,95,112,120,132,141,155,166',
                  '*,46,67,81,95,112,120,132,141,155,166',
                  '*,46,67,81,96,112,120,132,141,155,166',
                  '*,46,67,81,96,112,121,132,141,156,167',
                  '*,46,67,82,96,112,121,133,142,156,167',
                  '*,46,67,82,96,112,121,133,142,156,167',
                  '*,46,67,82,96,113,121,133,142,156,168',
                  '*,46,68,82,96,113,121,133,142,157,168',
                  '*,46,68,82,96,113,122,133,143,157,168',
                  '*,46,68,82,97,113,122,134,143,157,168',
                  '*,47,68,82,97,113,122,134,143,157,169',
                  '*,47,68,82,97,114,122,134,143,158,169',
                  '*,47,68,83,97,114,122,134,143,158,169',
                  '*,47,68,83,97,114,122,134,144,158,169',
                  '*,47,68,83,97,114,123,135,144,158,170',
                  '*,47,68,83,98,114,123,135,144,159,170',
                  '*,47,69,83,98,114,123,135,144,159,170',
                  '*,47,69,83,98,115,123,135,145,159,170',
                  '*,47,69,83,98,115,123,136,145,159,171',
                  '*,47,69,84,98,115,124,136,145,160,171',
                  '*,47,69,84,98,115,124,136,145,160,171',
                  '*,47,69,84,98,115,124,136,146,160,171',
                  '*,47,69,84,99,115,124,136,146,160,172',
                  '*,48,69,84,99,116,124,137,146,161,172',
                  '*,48,69,84,99,116,125,137,146,161,172',
                  '*,48,69,84,99,116,125,137,146,161,173',
                  '*,48,70,84,99,116,125,137,147,161,173',
                  '*,48,70,85,99,116,125,137,147,162,173',
                  '*,48,70,85,99,117,125,138,147,162,173',
                  '*,48,70,85,100,117,126,138,147,162,174',
                  '*,48,70,85,100,117,126,138,148,162,174',
                  '*,48,70,85,100,117,126,138,148,162,174',
                  '*,48,70,85,100,117,126,138,148,163,174',
                  '*,48,70,85,100,117,126,139,148,163,175',
                  '*,48,70,85,100,118,126,139,148,163,175',
                  '*,48,71,86,101,118,127,139,149,163,175',
                  '*,48,71,86,101,118,127,139,149,164,175',
                  '*,49,71,86,101,118,127,139,149,164,176',
                  '*,49,71,86,101,118,127,140,149,164,176',
                  '*,49,71,86,101,118,127,140,150,164,176',
                  '*,49,71,86,101,119,128,140,150,165,176',
                  '*,49,71,86,101,119,128,140,150,165,177',
                  '*,49,71,86,102,119,128,141,150,165,177',
                  '*,49,71,87,102,119,128,141,150,165,177',
                  '*,49,72,87,102,119,128,141,151,166,178',
                  '*,49,72,87,102,120,129,141,151,166,178',
                  '*,49,72,87,102,120,129,141,151,166,178',
                  '*,49,72,87,102,120,129,142,151,166,178',
                  '*,49,72,87,102,120,129,142,152,167,179',
                  '*,49,72,87,103,120,129,142,152,167,179',
                  '*,49,72,88,103,120,130,142,152,167,179',
                  '*,50,72,88,103,121,130,142,152,167,179',
                  '*,50,72,88,103,121,130,143,152,168,180',
                  '*,50,72,88,103,121,130,143,153,168,180',
                  '*,50,73,88,103,121,130,143,153,168,180',
                  '*,50,73,88,104,121,130,143,153,168,180',
                  '*,50,73,88,104,121,131,143,153,169,181',
                  '*,50,73,88,104,122,131,144,154,169,181',
                  '*,50,73,89,104,122,131,144,154,169,181',
                  '*,50,73,89,104,122,131,144,154,169,181',
                  '*,50,73,89,104,122,131,144,154,170,182',
                  '*,50,73,89,104,122,132,144,154,170,182',
                  '*,50,73,89,105,123,132,145,155,170,182',
                  '*,50,74,89,105,123,132,145,155,170,182',
                  '*,50,74,89,105,123,132,145,155,171,183',
                  '*,51,74,89,105,123,132,145,155,171,183',
                  '*,51,74,90,105,123,133,146,156,171,183',
                  '*,51,74,90,105,123,133,146,156,171,184',
                  '*,51,74,90,106,124,133,146,156,172,184',
                  '*,51,74,90,106,124,133,146,156,172,184',
                  '*,51,74,90,106,124,133,146,156,172,184',
                  '*,51,74,90,106,124,134,147,157,172,185',
                  '*,51,74,90,106,124,134,147,157,173,185',
                  '*,51,75,90,106,124,134,147,157,173,185',
                  '*,51,75,91,106,125,134,147,157,173,185',
                  '*,51,75,91,107,125,134,147,158,173,186',
                  '*,51,75,91,107,125,134,148,158,174,186',
                  '*,51,75,91,107,125,135,148,158,174,186',
                  '*,52,75,91,107,125,135,148,158,174,186',
                  '*,52,75,91,107,126,135,148,158,174,187',
                  '*,52,75,91,107,126,135,148,159,175,187',
                  '*,52,75,91,107,126,135,149,159,175,187',
                  '*,52,76,92,108,126,136,149,159,175,187',
                  '*,52,76,92,108,126,136,149,159,175,188',
                  '*,52,76,92,108,126,136,149,160,175,188',
                  '*,52,76,92,108,127,136,150,160,176,188',
                  '*,52,76,92,108,127,136,150,160,176,189',
                  '*,52,76,92,108,127,137,150,160,176,189',
                  '*,52,76,92,109,127,137,150,160,176,189',
                  '*,52,76,93,109,127,137,150,161,177,189',
                  '*,52,76,93,109,127,137,151,161,177,190',
                  '*,52,76,93,109,128,137,151,161,177,190',
                  '*,53,77,93,109,128,137,151,161,177,190',
                  '*,53,77,93,109,128,138,151,162,178,190',
                  '*,53,77,93,109,128,138,151,162,178,191',
                  '*,53,77,93,110,128,138,152,162,178,191',
                  '*,53,77,93,110,129,138,152,162,178,191',
                  '*,53,77,94,110,129,138,152,162,179,191',
                  '*,53,77,94,110,129,139,152,163,179,192',
                  '*,53,77,94,110,129,139,152,163,179,192',
                  '*,53,77,94,110,129,139,153,163,179,192',
                  '*,53,78,94,110,129,139,153,163,180,192',
                  '*,53,78,94,111,130,139,153,164,180,193',
                  '*,53,78,94,111,130,140,153,164,180,193',
                  '*,53,78,94,111,130,140,153,164,180,193',
                  '*,53,78,95,111,130,140,154,164,181,194',
                  '*,54,78,95,111,130,140,154,164,181,194',
                  '*,54,78,95,111,130,140,154,165,181,194',
                  '*,54,78,95,112,131,141,154,165,181,194',
                  '*,54,78,95,112,131,141,155,165,182,195',
                  '*,54,79,95,112,131,141,155,165,182,195',
                  '*,54,79,95,112,131,141,155,166,182,195',
                  '*,54,79,95,112,131,141,155,166,182,195',
                  '*,54,79,96,112,132,141,155,166,183,196',
                  '*,54,79,96,112,132,142,156,166,183,196',
                  '*,54,79,96,113,132,142,156,166,183,196',
                  '*,54,79,96,113,132,142,156,167,183,196',
                  '*,54,79,96,113,132,142,156,167,184,197',
                  '*,54,79,96,113,132,142,156,167,184,197',
                  '*,54,79,96,113,133,143,157,167,184,197',
                  '*,55,80,96,113,133,143,157,168,184,197',
                  '*,55,80,97,114,133,143,157,168,185,198',
                  '*,55,80,97,114,133,143,157,168,185,198',
                  '*,55,80,97,114,133,143,157,168,185,198',
                  '*,55,80,97,114,133,144,158,168,185,199',
                  '*,55,80,97,114,134,144,158,169,186,199',
                  '*,55,80,97,114,134,144,158,169,186,199',
                  '*,55,80,97,114,134,144,158,169,186,199',
                  '*,55,80,98,115,134,144,158,169,186,200',
                  '*,55,81,98,115,134,145,159,170,187,200',
                  '*,55,81,98,115,135,145,159,170,187,200',
                  '*,55,81,98,115,135,145,159,170,187,200',
                  '*,55,81,98,115,135,145,159,170,187,201',
                  '*,56,81,98,115,135,145,160,171,188,201',
                  '*,56,81,98,115,135,145,160,171,188,201',
                  '*,56,81,98,116,135,146,160,171,188,201',
                  '*,56,81,99,116,136,146,160,171,188,202',
                  '*,56,81,99,116,136,146,160,171,188,202',
                  '*,56,81,99,116,136,146,161,172,189,202',
                  '*,56,82,99,116,136,146,161,172,189,202',
                  '*,56,82,99,116,136,147,161,172,189,203',
                  '*,56,82,99,117,137,147,161,172,189,203',
                  '*,56,82,99,117,137,147,161,173,190,203',
                  '*,56,82,99,117,137,147,162,173,190,204',
                  '*,56,82,100,117,137,147,162,173,190,204',
                  '*,56,82,100,117,137,148,162,173,190,204',
                  '*,56,82,100,117,137,148,162,173,191,204',
                  '*,57,82,100,117,138,148,162,174,191,205',
                  '*,57,83,100,118,138,148,163,174,191,205',
                  '*,57,83,100,118,138,148,163,174,191,205',
                  '*,57,83,100,118,138,149,163,174,192,205',
                  '*,57,83,100,118,138,149,163,175,192,206',
                  '*,57,83,101,118,138,149,163,175,192,206',
                  '*,57,83,101,118,139,149,164,175,192,206',
                  '*,57,83,101,118,139,149,164,175,193,206',
                  '*,57,83,101,119,139,149,164,175,193,207',
                  '*,57,83,101,119,139,150,164,176,193,207',
                  '*,57,83,101,119,139,150,165,176,193,207',
                  '*,57,84,101,119,140,150,165,176,194,207',
                  '*,57,84,102,119,140,150,165,176,194,208',
                  '*,57,84,102,119,140,150,165,177,194,208',
                  '*,58,84,102,120,140,151,165,177,194,208',
                  '*,58,84,102,120,140,151,166,177,195,209',
                  '*,58,84,102,120,140,151,166,177,195,209',
                  '*,58,84,102,120,141,151,166,177,195,209',
                  '*,58,84,102,120,141,151,166,178,195,209',
                  '*,58,84,102,120,141,152,166,178,196,210',
                  '*,58,85,103,120,141,152,167,178,196,210',
                  '*,58,85,103,121,141,152,167,178,196,210',
                  '*,58,85,103,121,141,152,167,179,196,210',
                  '*,58,85,103,121,142,152,167,179,197,211',
                  '*,58,85,103,121,142,153,167,179,197,211',
                  '*,58,85,103,121,142,153,168,179,197,211',
                  '*,58,85,103,121,142,153,168,179,197,211',
                  '*,58,85,103,122,142,153,168,180,198,212',
                  '*,59,85,104,122,143,153,168,180,198,212',
                  '*,59,85,104,122,143,153,169,180,198,212',
                  '*,59,86,104,122,143,154,169,180,198,212',
                  '*,59,86,104,122,143,154,169,181,199,213',
                  '*,59,86,104,122,143,154,169,181,199,213',
                  '*,59,86,104,122,143,154,169,181,199,213',
                  '*,59,86,104,123,144,154,170,181,199,214',
                  '*,59,86,104,123,144,155,170,181,200,214',
                  '*,59,86,105,123,144,155,170,182,200,214',
                  '*,59,86,105,123,144,155,170,182,200,214',
                  '*,59,86,105,123,144,155,170,182,200,215',
                  '*,59,87,105,123,144,155,171,182,201,215',
                  '*,59,87,105,123,145,156,171,183,201,215',
                  '*,59,87,105,124,145,156,171,183,201,215',
                  '*,60,87,105,124,145,156,171,183,201,216',
                  '*,60,87,105,124,145,156,171,183,202,216',
                  '*,60,87,106,124,145,156,172,183,202,216',
                  '*,60,87,106,124,146,157,172,184,202,216',
                  '*,60,87,106,124,146,157,172,184,202,217',
                  '*,60,87,106,125,146,157,172,184,202,217',
                  '*,60,88,106,125,146,157,172,184,203,217',
                  '*,60,88,106,125,146,157,173,185,203,217',
                  '*,60,88,106,125,146,157,173,185,203,218',
                  '*,60,88,107,125,147,158,173,185,203,218',
                  '*,60,88,107,125,147,158,173,185,204,218',
                  '*,60,88,107,125,147,158,174,185,204,219',
                  '*,60,88,107,126,147,158,174,186,204,219',
                  '*,61,88,107,126,147,158,174,186,204,219',
                  '*,61,88,107,126,147,159,174,186,205,219',
                  '*,61,88,107,126,148,159,174,186,205,220',
                  '*,61,89,107,126,148,159,175,187,205,220',
                  '*,61,89,108,126,148,159,175,187,205,220',
                  '*,61,89,108,126,148,159,175,187,206,220',
                  '*,61,89,108,127,148,160,175,187,206,221',
                  '*,61,89,108,127,149,160,175,187,206,221',
                  '*,61,89,108,127,149,160,176,188,206,221',
                  '*,61,89,108,127,149,160,176,188,207,221',
                  '*,61,89,108,127,149,160,176,188,207,222',
                  '*,61,89,108,127,149,161,176,188,207,222',
                  '*,61,90,109,128,149,161,176,189,207,222',
                  '*,61,90,109,128,150,161,177,189,208,222',
                  '*,62,90,109,128,150,161,177,189,208,223',
                  '*,62,90,109,128,150,161,177,189,208,223',
                  '*,62,90,109,128,150,161,177,189,208,223',
                  '*,62,90,109,128,150,162,177,190,209,224',
                  '*,62,90,109,128,150,162,178,190,209,224',
                  '*,62,90,109,129,151,162,178,190,209,224',
                  '*,62,90,110,129,151,162,178,190,209,224',
                  '*,62,90,110,129,151,162,178,191,210,225',
                  '*,62,91,110,129,151,163,179,191,210,225',
                  '*,62,91,110,129,151,163,179,191,210,225',
                  '*,62,91,110,129,152,163,179,191,210,225',
                  '*,62,91,110,130,152,163,179,191,211,226',
                  '*,62,91,110,130,152,163,179,192,211,226',
                  '*,62,91,111,130,152,164,180,192,211,226',
                  '*,63,91,111,130,152,164,180,192,211,226',
                  '*,63,91,111,130,152,164,180,192,212,227',
                  '*,63,91,111,130,153,164,180,193,212,227',
                  '*,63,92,111,130,153,164,180,193,212,227',
                  '*,63,92,111,131,153,165,181,193,212,227',
                  '*,63,92,111,131,153,165,181,193,213,228',
                  '*,63,92,111,131,153,165,181,193,213,228',
                  '*,63,92,112,131,153,165,181,194,213,228',
                  '*,63,92,112,131,154,165,181,194,213,229',
                  '*,63,92,112,131,154,165,182,194,214,229',
                  '*,63,92,112,131,154,166,182,194,214,229',
                  '*,63,92,112,132,154,166,182,195,214,229',
                  '*,63,92,112,132,154,166,182,195,214,230',
                  '*,63,93,112,132,155,166,182,195,215,230',
                  '*,64,93,112,132,155,166,183,195,215,230',
                  '*,64,93,113,132,155,167,183,195,215,230',
                  '*,64,93,113,132,155,167,183,196,215,231',
                  '*,64,93,113,133,155,167,183,196,215,231',
                  '*,64,93,113,133,155,167,184,196,216,231',
                  '*,64,93,113,133,156,167,184,196,216,231',
                  '*,64,93,113,133,156,168,184,197,216,232',
                  '*,64,93,113,133,156,168,184,197,216,232',
                  '*,64,94,113,133,156,168,184,197,217,232',
                  '*,64,94,114,133,156,168,185,197,217,232',
                  '*,64,94,114,134,156,168,185,198,217,233',
                  '*,64,94,114,134,157,168,185,198,217,233',
                  '*,64,94,114,134,157,169,185,198,218,233',
                  '*,65,94,114,134,157,169,185,198,218,234',
                  '*,65,94,114,134,157,169,186,198,218,234',
                  '*,65,94,114,134,157,169,186,199,218,234',
                  '*,65,94,114,134,158,169,186,199,219,234',
                  '*,65,95,115,135,158,170,186,199,219,235',
                  '*,65,95,115,135,158,170,186,199,219,235',
                  '*,65,95,115,135,158,170,187,200,219,235',
                  '*,65,95,115,135,158,170,187,200,220,235',
                  '*,65,95,115,135,158,170,187,200,220,236',
                  '*,65,95,115,135,159,171,187,200,220,236',
                  '*,65,95,115,136,159,171,188,200,220,236',
                  '*,65,95,116,136,159,171,188,201,221,236',
                  '*,65,95,116,136,159,171,188,201,221,237',
                  '*,65,95,116,136,159,171,188,201,221,237',
                  '*,66,96,116,136,159,172,188,201,221,237',
                  '*,66,96,116,136,160,172,189,202,222,237',
                  '*,66,96,116,136,160,172,189,202,222,238',
                  '*,66,96,116,137,160,172,189,202,222,238',
                  '*,66,96,116,137,160,172,189,202,222,238',
                  '*,66,96,117,137,160,172,189,202,223,239',
                  '*,66,96,117,137,161,173,190,203,223,239',
                  '*,66,96,117,137,161,173,190,203,223,239',
                  '*,66,96,117,137,161,173,190,203,223,239',
                  '*,66,97,117,138,161,173,190,203,224,240',
                  '*,66,97,117,138,161,173,190,204,224,240',
                  '*,66,97,117,138,161,174,191,204,224,240',
                  '*,66,97,117,138,162,174,191,204,224,240',
                  '*,66,97,118,138,162,174,191,204,225,241',
                  '*,67,97,118,138,162,174,191,204,225,241',
                  '*,67,97,118,138,162,174,191,205,225,241',
                  '*,67,97,118,139,162,175,192,205,225,241',
                  '*,67,97,118,139,162,175,192,205,226,242',
                  '*,67,97,118,139,163,175,192,205,226,242',
                  '*,67,98,118,139,163,175,192,206,226,242',
                  '*,67,98,118,139,163,175,193,206,226,242',
                  '*,67,98,119,139,163,176,193,206,227,243',
                  '*,67,98,119,139,163,176,193,206,227,243',
                  '*,67,98,119,140,164,176,193,206,227,243',
                  '*,67,98,119,140,164,176,193,207,227,244',
                  '*,67,98,119,140,164,176,194,207,228,244',
                  '*,67,98,119,140,164,176,194,207,228,244',
                  '*,67,98,119,140,164,177,194,207,228,244',
                  '*,68,99,119,140,164,177,194,208,228,245',
                  '*,68,99,120,141,165,177,194,208,229,245',
                  '*,68,99,120,141,165,177,195,208,229,245',
                  '*,68,99,120,141,165,177,195,208,229,245',
                  '*,68,99,120,141,165,178,195,208,229,246',
                  '*,68,99,120,141,165,178,195,209,229,246',
                  '*,68,99,120,141,166,178,195,209,230,246',
                  '*,68,99,120,141,166,178,196,209,230,246',
                  '*,68,99,121,142,166,178,196,209,230,247',
                  '*,68,99,121,142,166,179,196,210,230,247',
                  '*,68,100,121,142,166,179,196,210,231,247',
                  '*,68,100,121,142,166,179,196,210,231,247',
                  '*,68,100,121,142,167,179,197,210,231,248',
                  '*,69,100,121,142,167,179,197,210,231,248',
                  '*,69,100,121,142,167,180,197,211,232,248',
                  '*,69,100,121,143,167,180,197,211,232,249',
                  '*,69,100,122,143,167,180,198,211,232,249',
                  '*,69,100,122,143,167,180,198,211,232,249',
                  '*,69,100,122,143,168,180,198,212,233,249',
                  '*,69,101,122,143,168,180,198,212,233,250',
                  '*,69,101,122,143,168,181,198,212,233,250',
                  '*,69,101,122,144,168,181,199,212,233,250',
                  '*,69,101,122,144,168,181,199,212,234,250',
                  '*,69,101,122,144,169,181,199,213,234,251',
                  '*,69,101,123,144,169,181,199,213,234,251',
                  '*,69,101,123,144,169,182,199,213,234,251',
                  '*,69,101,123,144,169,182,200,213,235,251',
                  '*,70,101,123,144,169,182,200,214,235,252',
                  '*,70,101,123,145,169,182,200,214,235,252',
                  '*,70,102,123,145,170,182,200,214,235,252',
                  '*,70,102,123,145,170,183,200,214,236,252',
                  '*,70,102,123,145,170,183,201,214,236,253',
                  '*,70,102,124,145,170,183,201,215,236,253',
                  '*,70,102,124,145,170,183,201,215,236,253',
                  '*,70,102,124,146,170,183,201,215,237,253',
                  '*,70,102,124,146,171,184,201,215,237,254',
                  '*,70,102,124,146,171,184,202,216,237,254',
                  '*,70,102,124,146,171,184,202,216,237,254',
                  '*,70,103,124,146,171,184,202,216,238,255',
                  '*,70,103,125,146,171,184,202,216,238,255',
                  '*,70,103,125,146,172,184,203,216,238,255',
                  '*,71,103,125,147,172,185,203,217,238,255',
                  '*,71,103,125,147,172,185,203,217,239,256',
                  '*,71,103,125,147,172,185,203,217,239,256',
                  '*,71,103,125,147,172,185,203,217,239,256',
                  '*,71,103,125,147,172,185,204,218,239,256',
                  '*,71,103,125,147,173,186,204,218,240,257',
                  '*,71,104,126,147,173,186,204,218,240,257',
                  '*,71,104,126,148,173,186,204,218,240,257',
                  '*,71,104,126,148,173,186,204,218,240,257',
                  '*,71,104,126,148,173,186,205,219,241,258',
                  '*,71,104,126,148,173,187,205,219,241,258',
                  '*,71,104,126,148,174,187,205,219,241,258',
                  '*,71,104,126,148,174,187,205,219,241,258',
                  '*,71,104,126,149,174,187,205,220,242,259',
                  '*,72,104,127,149,174,187,206,220,242,259',
                  '*,72,104,127,149,174,188,206,220,242,259',
                  '*,72,105,127,149,175,188,206,220,242,260',
                  '*,72,105,127,149,175,188,206,220,242,260',
                  '*,72,105,127,149,175,188,207,221,243,260',
                  '*,72,105,127,149,175,188,207,221,243,260',
                  '*,72,105,127,150,175,188,207,221,243,261',
                  '*,72,105,127,150,175,189,207,221,243,261',
                  '*,72,105,128,150,176,189,207,222,244,261',
                  '*,72,105,128,150,176,189,208,222,244,261',
                  '*,72,105,128,150,176,189,208,222,244,262',
                  '*,72,106,128,150,176,189,208,222,244,262',
                  '*,72,106,128,150,176,190,208,222,245,262',
                  '*,72,106,128,151,176,190,208,223,245,262',
                  '*,73,106,128,151,177,190,209,223,245,263',
                  '*,73,106,128,151,177,190,209,223,245,263',
                  '*,73,106,129,151,177,190,209,223,246,263',
                  '*,73,106,129,151,177,191,209,224,246,263',
                  '*,73,106,129,151,177,191,209,224,246,264',
                  '*,73,106,129,152,178,191,210,224,246,264',
                  '*,73,106,129,152,178,191,210,224,247,264',
                  '*,73,107,129,152,178,191,210,225,247,265',
                  '*,73,107,129,152,178,192,210,225,247,265',
                  '*,73,107,130,152,178,192,210,225,247,265',
                  '*,73,107,130,152,178,192,211,225,248,265',
                  '*,73,107,130,152,179,192,211,225,248,266',
                 ]

    return rate_sw2_0
  end

  def getNewRates(rate_sw2_0)
    rate_3 = []
    rate_4 = []
    rate_5 = []
    rate_6 = []
    rate_7 = []
    rate_8 = []
    rate_9 = []
    rate_10 = []
    rate_11 = []
    rate_12 = []
    zeroArray = []

    rate_sw2_0.each do |rateText|
      rate_arr = rateText.split(/,/)
      zeroArray.push( 0 )
      rate_3.push( rate_arr[1].to_i )
      rate_4.push( rate_arr[2].to_i )
      rate_5.push( rate_arr[3].to_i )
      rate_6.push( rate_arr[4].to_i )
      rate_7.push( rate_arr[5].to_i )
      rate_8.push( rate_arr[6].to_i )
      rate_9.push( rate_arr[7].to_i )
      rate_10.push( rate_arr[8].to_i )
      rate_11.push( rate_arr[9].to_i )
      rate_12.push( rate_arr[10].to_i )
    end

    if(@rating_table == 1)
      # 完全版準拠に差し替え
      rate_12[31] = rate_12[32] = rate_12[33] = 10
    end

    newRates = [zeroArray, zeroArray, zeroArray, rate_3, rate_4, rate_5, rate_6, rate_7, rate_8, rate_9, rate_10, rate_11, rate_12]

    return newRates
  end

  def rollDice(values)
    dice, diceText = roll(2, 6)
    return dice, diceText
  end


  def getResultText(totalValue, addValue, diceResults, diceResultTotals,
                    rateResults, diceOnlyTotal, round, crit, limitLength)
    output = ""

    totalText = (totalValue + addValue).to_s

    if(sendMode > 1)           # 表示モード２以上
      output += "2D:[#{diceResults.join(' ')}]=#{diceResultTotals.join(',')}"
      rateResultsText = rateResults.join(',')
      output += " ＞ #{rateResultsText}" unless( rateResultsText == totalText )
    elsif(sendMode > 0)  # 表示モード１以上
      output += "2D:#{diceResultTotals.join(',')}"
    else                     # 表示モード０
      output += "#{totalValue}"
    end

    if(diceOnlyTotal <= 2)
      return "#{output} ＞ 自動的失敗"
    end

    addText = getAddText(addValue)
    output += "#{addText} ＞ "

    roundText = ""
    if(round > 1)
      roundText += "#{round - 1}回転 ＞ "
    end

    output += "#{roundText}#{totalText}"

    if ( output.length > limitLength) # 回りすぎて文字列オーバーしたときの救済
      output = "... ＞ #{roundText}#{totalText}"
    end

    return output
  end

  def getAddText(addValue)
    addText = ""

    return addText if( addValue == 0 )

    operator = ((addValue > 0) ? "+" : "")
    addText += "#{operator}#{addValue}"

    return addText
  end

  def setRatingTable(tnick)
    mode_str = ""
    pre_mode = @rating_table;

    if( /(\d+)/ =~ tnick )
      @rating_table = $1.to_i;
      if (@rating_table > 1)
        mode_str = "2.0-mode";
        @rating_table = 2;
      elsif (@rating_table > 0)
        mode_str = "new-mode";
        @rating_table = 1;
      else
        mode_str = "old-mode";
        @rating_table = 0;
      end
    else
      case tnick
      when /old/i
        @rating_table = 0;
        mode_str = "old-mode";
      when /new/i
        @rating_table = 1;
        mode_str = "new-mode";
      when /2\.0/i
        @rating_table = 2;
        mode_str = "2.0-mode";
      end
    end

    return '1' if( @rating_table == pre_mode )

    return "RatingTableを#{mode_str}に変更しました"
  end
end
